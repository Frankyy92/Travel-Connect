
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  nickname  String?
  language  String?
  xp        Int      @default(0)
  level     Int      @default(1)
  badges    UserBadge[]
  visits    Visit[]
  itineraries Itinerary[]
}

model POI {
  id         String   @id @default(uuid())
  title      String
  city       String
  categories String[]
  lat        Float
  lng        Float
  snippet    String
  durationMin Int
  popularity Float     @default(0)
  openHours  String?
  mediaUrl   String?
  quests     Quest[]
}

model Quest {
  id       String  @id @default(uuid())
  poiId    String
  type     QuestType
  prompt   String
  answer   String?
  points   Int      @default(20)
  poi      POI      @relation(fields: [poiId], references: [id])
}

enum QuestType {
  QUIZ
  PHOTO
  AR
}

model Visit {
  id      String   @id @default(uuid())
  userId  String
  poiId   String
  ts      DateTime @default(now())
  method  String
  validated Boolean @default(true)
  user    User     @relation(fields: [userId], references: [id])
  poi     POI      @relation(fields: [poiId], references: [id])
}

model Badge {
  id       String   @id @default(uuid())
  name     String   @unique
  tier     String
  category String
}

model UserBadge {
  id      String   @id @default(uuid())
  userId  String
  badgeId String
  ts      DateTime @default(now())
  user    User     @relation(fields: [userId], references: [id])
  badge   Badge    @relation(fields: [badgeId], references: [id])
}

model Itinerary {
  id            String   @id @default(uuid())
  userId        String
  startLat      Float
  startLng      Float
  durationTarget Int
  poiIds        String
  totalDistance Float
  totalTime     Int
  user          User     @relation(fields: [userId], references: [id])
}


model FeaturedItinerary {
  id             String  @id @default(uuid())
  city           String
  name           String
  durationTarget Int
  description    String?
  bannerUrl      String?
  poiIds         String   // CSV of POI ids
}
